name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-title:
    name: Validate PR Title
    runs-on: ubuntu-latest
    steps:
      - name: Check PR title
        run: |
          echo "PR Title: ${{ github.event.pull_request.title }}"
          # Add any custom PR title validation here if needed

  changes:
    name: Detect Changes
    runs-on: ubuntu-latest
    outputs:
      python: ${{ steps.filter.outputs.python }}
      docs: ${{ steps.filter.outputs.docs }}
      rust: ${{ steps.filter.outputs.rust }}
    steps:
      - uses: actions/checkout@v4

      - uses: dorny/paths-filter@v3
        id: filter
        with:
          filters: |
            python:
              - 'src/simulor/**/*.py'
              - 'tests/**/*.py'
              - 'pyproject.toml'
            docs:
              - '**.md'
              - 'docs/**'
            rust:
              - 'rust/**/*.rs'
              - 'rust/Cargo.toml'

  quick-check:
    name: Quick Check
    runs-on: ubuntu-latest
    needs: changes
    if: needs.changes.outputs.python == 'true'
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -e ".[dev]"

      - name: Quick lint check
        run: |
          ruff check src/simulor/

      - name: Quick test run
        run: |
          pytest tests/ -x --tb=short
